document.addEventListener("DOMContentLoaded",(()=>{let t=0;class s{constructor(t,s){this.width=t,this.height=s}}class i{constructor(t,s){this.x=t,this.y=s}}const h=new class{constructor(t,s){this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=s,this.t=this.canvas.getContext("2d")}draw(t){t(this.canvas,this.t)}i(){const t=new Image;return t.src=this.canvas.toDataURL(),t}}(150,150);h.draw(((t,s)=>{const i=t.width,h=t.height,e=Math.min(i,h)/2-10,n=i/2,o=h/2,r=Math.max(.5*e,1),c=s.createRadialGradient(n,o,r,n,o,e);c.addColorStop(0,"#ffd700"),c.addColorStop(.5,"#ffcc00"),c.addColorStop(1,"#b8860b"),s.fillStyle=c,s.beginPath(),s.arc(n,o,e,0,2*Math.PI),s.fill(),s.lineWidth=5,s.strokeStyle="#b8860b",s.stroke(),s.fillStyle="#000",s.beginPath(),s.moveTo(n-20,o+10),s.lineTo(n+20,o+10),s.lineTo(n+15,o+20),s.lineTo(n-15,o+20),s.closePath(),s.fill(),s.beginPath(),s.moveTo(n,o+10),s.lineTo(n,o-20),s.lineWidth=2,s.strokeStyle="#000",s.stroke(),s.beginPath(),s.moveTo(n,o-10),s.lineTo(n+12,o),s.lineTo(n,o),s.closePath(),s.fill(),s.beginPath(),s.moveTo(n,o-15),s.lineTo(n+8,o-10),s.lineTo(n,o-10),s.closePath(),s.fill(),s.beginPath(),s.moveTo(n,o-20),s.lineTo(n+10,o-15),s.lineTo(n,o-15),s.closePath(),s.fill()}));const e=h.i();class n{constructor(t,s,i){void 0===s?(t=parseInt(t.slice(1),16),this.r=t>>16,this.g=t>>8&255,this.b=255&t,this.h=`#${t.toString(16).padStart(6,"0").toUpperCase()}`):(this.r=t,this.g=s,this.b=i,this.h=`#${(t<<16|s<<8|i).toString(16).padStart(6,"0").toUpperCase()}`)}o(){return`rgb(${this.r},${this.g},${this.b})`}u(){return this.h}}const o=new n(0,0,0),r=new n(255,255,255);let c=document.getElementById("game");c.width=1280,c.height=720;let a=c.getContext("2d"),u=document.getElementById("overlay");const l=new class{constructor(){this.title="",u.l=""}close(){u.l=""}open(t){this.close();let s=document.createElement("div");s.classList.add("card");let i=document.createElement("header");if(i.classList.add("card-header"),i.style.backgroundColor=t.color.u(),void 0!==t.title){let s=document.createElement("h3");s.style.color=(h=t.color,(.299*h.r+.587*h.g+.114*h.b)/255>.5?o:r).u(),s.innerHTML=t.title,i.appendChild(s)}var h;let n=document.createElement("img");n.src=e.src,i.append(n),s.appendChild(i),u.appendChild(s)}};let d=new i(0,0);function f(t,s,i=0){function h(t){return t*t*(3-2*t)}function e(t,s,i){return t+i*(s-t)}function n(t,s,i){const h=t+57*s+131*i;return 43758.5453*Math.sin(h)-Math.floor(43758.5453*Math.sin(h))}const o=Math.floor(t),r=o+1,c=Math.floor(s),a=c+1,u=h(t-o),l=h(s-c),d=e(n(o,c,i),n(r,c,i),u),f=e(n(o,a,i),n(r,a,i),u);return e(d,f,l)}c.addEventListener("mousemove",(function(t){let s=function(t){const s=c.getBoundingClientRect();return{x:c.width/s.width*(t.clientX-s.left),y:c.height/s.height*(t.clientY-s.top)}}(t);d=new i(s.x,s.y)}));class w{constructor(t,s,h){this.M=t,this.x=s,this.y=h,this.width=this.M.m.width,this.height=this.M.m.height,this.color="",this.p=!1,this.v=!1,this.A=!1,this.S=0,this.C=.05,this.offset=new i(0,0)}I(){this.S=0,this.v=!0,this.A=!1}L(){this.v&&(this.S+=this.C,this.S>=1&&(this.S=1,this.v=!1,this.A=!0))}H(){this.L();const t=this.v?Math.max(0,1-2*this.S):1,s=this.width*(1-t)/2;a.save(),a.translate(this.x+s,this.y),a.scale(t,1),a.fillStyle=this.color.u(),a.beginPath(),a.roundRect(0,0,this.width,this.height,this.M.R),a.fill(),a.fillStyle="#ffffff",a.globalAlpha=.15,a.fillRect(0,this.M.$,this.width,.15*this.height),a.fillRect(0,this.height-2.5*this.M.$,this.width,.15*this.height),a.globalAlpha=1,a.restore()}k(){this.v||(a.fillStyle="#ffffff",a.globalAlpha=Math.abs(Math.sin(.1*t)),a.roundRect(this.x+this.offset.x,this.y+this.offset.y,this.width,this.height,this.M.R),a.fill(),a.globalAlpha=1)}}class M{constructor(t){this.q=t,this.m=new s(32,45),this.$=Math.floor(this.m.width/6),this.R=Math.floor(this.m.width/6);let i=Math.floor(c.width/this.m.width);this.D=i+i*this.$;let h=Math.floor(c.height/this.m.height);var e;this.O=h+h*this.$,this.T=[],this.B=(e=this.O,Array.from({length:this.D},(()=>Array(e)))),this.seed=Math.floor(25566*Math.random())+0,this.F(),c.addEventListener("click",(()=>{for(let t=0;t<this.B.length;t++)for(let s=0;s<this.B[t].length;s++){let i=this.B[t][s];i.p&&(i.I(),l.open(i))}}))}F(){for(let t=0;t<this.D;t++)for(let s=0;s<this.O;s++){let i=new w(this,t*this.m.width+t*this.$,s*this.m.height+s*this.$);i.title="Test Card";let h=f(t/3,s/3,this.seed),e=255*h,o=new n(e,e,e);h<.4?i.title="DEEP SEA":h<.7&&(i.title="SHALLOW SEA"),h<.65?o=new n(0,0,50*Math.round(e/50)):h>=.65&&h<.8?(o=new n(200,170,e),i.title="BEACH"):(o=new n(0,Math.floor(.65*e),0),i.title="GRASS HILLS"),i.color=new n(20,20,20),this.B[t][s]=i}}H(){for(let t=0;t<this.B.length;t++)for(let s=0;s<this.B[t].length;s++){let i=this.B[t][s];i.H(),d.x>i.x&&d.x<i.x+this.m.width&&d.y>i.y&&d.y<i.y+this.m.height?(i.p=!0,this.q.G("c-"+t+"-"+s,"pointer")):(i.p=!1,this.q.P("c-"+t+"-"+s)),i.p&&i.k()}}}const m=new class{constructor(){this.M=new M(this),this.T=[],this.W()}G(t,s){let i=!1;for(let s=0;s<this.T.length;s++)this.T[s].key==t&&(i=!0);return!i&&(this.T.push({key:t,cursor:s}),!0)}P(t){for(let s=0;s<this.T.length;s++)this.T[s].key==t&&(this.T.splice(s,1),s--)}j(){c.style.cursor=this.T.length>0?"pointer":"default"}update(){this.j(),t++}H(){a.clearRect(0,0,c.width,c.height),this.M.H()}loop(){this.update(),this.H(),window.requestAnimationFrame(this.loop.bind(this))}W(){this.loop()}},p=parseInt(window.getComputedStyle(c).zIndex)||0;document.addEventListener("mousemove",(function(t){const s=document.elementFromPoint(t.clientX,t.clientY);s!==c&&((parseInt(window.getComputedStyle(s).zIndex)||0)>p?(m.T.length=0,c.style.pointerEvents="none"):c.style.pointerEvents="auto")})),c.addEventListener("click",(function(t){const s=document.elementFromPoint(t.clientX,t.clientY),i=parseInt(window.getComputedStyle(s).zIndex)||0;if(s!==c&&i>p)return m.T.length=0,void t.stopImmediatePropagation()}))}));